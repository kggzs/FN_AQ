# 工作流名称：自动签到
name: 自动签到

# 触发条件：定时执行 + 手动触发
on:
  schedule:
    # 每天 UTC 0:00 执行（对应北京时间 8:00，时区差异注意）
    - cron: '0 0 * * *'
  workflow_dispatch: # 允许在 GitHub 网页端手动触发该工作流

# 定义执行任务
jobs:
  sign:
    # 运行环境：最新版 Ubuntu 系统
    runs-on: ubuntu-latest
    
    # 任务执行步骤
    steps:
    # 步骤1：检出仓库代码到运行环境
    - name: 检出代码
      uses: actions/checkout@v4 # 升级为最新稳定版（替代 v3，避免后续废弃提示）
      
    # 步骤2：配置 Python 运行环境
    - name: 设置 Python 环境
      uses: actions/setup-python@v4
      with:
        python-version: '3.9' # 指定 Python 3.9 版本，与脚本兼容
        
    # 步骤3：安装脚本所需依赖包
    - name: 安装依赖
      run: |
        pip install --upgrade pip # 升级 pip 到最新版
        pip install requests beautifulsoup4 # 安装签到脚本依赖
        
    # 步骤4：执行自动签到脚本
    - name: 运行签到脚本
      # 注入敏感环境变量（从 GitHub Secrets 中读取）
      env:
        USERNAME: ${{ secrets.USERNAME }}
        PASSWORD: ${{ secrets.PASSWORD }}
        API_KEY: ${{ secrets.API_KEY }}
        SECRET_KEY: ${{ secrets.SECRET_KEY }}
        IYUU_TOKEN: ${{ secrets.IYUU_TOKEN }}
      # 执行 Python 签到脚本
      run: |
        python fnclub_signer.py
        
    # 步骤5：上传签到日志（无论前序步骤成功/失败，均执行）
    - name: 上传日志
      if: always() # 保证即使签到脚本执行失败，也能上传日志用于排查问题
      uses: actions/upload-artifact@v4 # 核心升级：替代已废弃的 v3 版本
      with:
        name: sign-logs # 上传的产物包名称
        path: logs/ # 日志文件所在目录（脚本需保证该目录生成日志）
        retention-days: 7 # 日志保留时间：7 天，到期自动删除